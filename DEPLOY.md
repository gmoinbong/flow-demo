# Инструкции по деплою фронтенда на Render.com

## Быстрый старт

1. Подключите GitHub репозиторий в Render
2. Создайте Web Service
3. Укажите Root Directory: `metrek`
4. Добавьте переменную: `NEXT_PUBLIC_BASE_URL=https://your-backend.onrender.com`
5. Деплой готов!

Подробные инструкции ниже.

---

## Вариант 1: Нативный деплой Next.js (рекомендуется)

Render.com автоматически определяет Next.js проекты и настраивает их правильно.

### Шаги:

1. **Подключите репозиторий в Render Dashboard**
   - Зайдите в [Render Dashboard](https://dashboard.render.com)
   - Нажмите "New +" → "Web Service"
   - Подключите ваш GitHub/GitLab репозиторий
   - Выберите репозиторий с фронтендом

2. **Настройки сервиса:**
   - **Name**: `creatorflow-frontend` (или любое другое имя)
   - **Root Directory**: `metrek` (если репозиторий в корне проекта CreatorFlow)
   - **Environment**: `Node`
   - **Build Command**: `npm install && npm run build`
   - **Start Command**: `npm start`
   - **Node Version**: `20.x` (или последняя LTS)
   - **Plan**: Free (для начала) или Starter ($7/мес)

3. **Переменные окружения** (Environment Variables):
   
   В разделе "Environment" добавьте:
   ```
   NODE_ENV=production
   NEXT_PUBLIC_BASE_URL=https://your-backend-url.onrender.com
   ```
   
   **Важно:**
   - `NEXT_PUBLIC_BASE_URL` - полный URL вашего бекенда (например: `https://creatorflow-backend.onrender.com`)
   - НЕ добавляйте `/` в конце URL
   - `PORT` устанавливается автоматически Render, не нужно указывать
   - Все переменные с префиксом `NEXT_PUBLIC_` доступны в браузере (клиентский код)
   - Переменные без `NEXT_PUBLIC_` доступны только на сервере (API routes)

4. **Планы:**
   - **Free**: бесплатно, но засыпает после 15 минут бездействия
   - **Starter ($7/мес)**: не засыпает, больше ресурсов

5. **Деплой:**
   - Render автоматически задеплоит при push в основную ветку
   - Или нажмите "Manual Deploy" для ручного деплоя

### После деплоя:

1. **Получите URL вашего фронтенда**
   - После успешного деплоя Render покажет URL (например: `https://creatorflow-frontend.onrender.com`)
   - Сохраните этот URL

2. **Обновите CORS на бекенде**
   - Зайдите в настройки вашего бекенда на Render
   - Добавьте URL фронтенда в переменные окружения или обновите код:
   ```typescript
   // В NestJS бекенде (main.ts или app.module.ts)
   app.enableCors({
     origin: [
       process.env.FRONTEND_URL || 'https://creatorflow-frontend.onrender.com',
       'http://localhost:3001', // для локальной разработки
     ],
     credentials: true,
   });
   ```

3. **Проверьте работу приложения**
   - Откройте URL фронтенда в браузере
   - Попробуйте залогиниться
   - Проверьте DevTools → Network для проверки API запросов

## Вариант 2: Docker деплой

Если нужен больший контроль или вы хотите использовать Docker.

**Dockerfile уже создан** в корне проекта `metrek/Dockerfile`.

### Настройки в Render:

1. **Environment**: `Docker`
2. **Dockerfile Path**: `metrek/Dockerfile` (если репозиторий в корне проекта)
3. **Docker Context**: `metrek` (если репозиторий в корне)
4. **Build Command**: (оставьте пустым, Render автоматически использует Dockerfile)
5. **Start Command**: (оставьте пустым, Render автоматически запустит контейнер)

### Переменные окружения (те же что и в Варианте 1):

```
NODE_ENV=production
NEXT_PUBLIC_BASE_URL=https://your-backend.onrender.com
```

**Примечание:** Docker деплой занимает больше времени на сборку, но дает больше контроля над окружением.

## Переменные окружения

### Обязательные:

```env
NODE_ENV=production
NEXT_PUBLIC_BASE_URL=https://your-backend.onrender.com
```

### Опциональные:

```env
PORT=10000
NEXT_PUBLIC_APP_URL=https://your-frontend.onrender.com
```

## Настройка CORS на бекенде

После деплоя фронтенда нужно обновить CORS настройки на бекенде:

```typescript
// В NestJS бекенде
app.enableCors({
  origin: [
    'https://your-frontend.onrender.com',
    'http://localhost:3001', // для локальной разработки
  ],
  credentials: true,
});
```

## Проблемы и решения

### Проблема: "Application error" при первом деплое

**Решение:**
- Проверьте логи в Render Dashboard
- Убедитесь что все переменные окружения установлены
- Проверьте что `NEXT_PUBLIC_BASE_URL` указывает на правильный URL бекенда

### Проблема: API запросы не работают

**Решение:**
- Проверьте `NEXT_PUBLIC_BASE_URL` - должен быть полный URL с протоколом
- Убедитесь что бекенд разрешает CORS запросы с вашего фронтенда
- Проверьте что бекенд доступен (не заснул на free плане)

### Проблема: Приложение засыпает (free план)

**Решение:**
- Первый запрос после засыпания может занять 30-60 секунд (cold start)
- Рассмотрите upgrade до Starter плана ($7/мес) для постоянной работы
- Или используйте альтернативные платформы (см. ниже)

## Альтернативные платформы

### 1. Vercel (рекомендуется для Next.js)
- ✅ Создана командой Next.js
- ✅ Бесплатный план с хорошими лимитами
- ✅ Автоматический деплой из Git
- ✅ Не засыпает
- ✅ Отличная производительность

**Настройка:**
1. Подключите GitHub репозиторий
2. Vercel автоматически определит Next.js
3. Добавьте переменные окружения
4. Готово!

### 2. Railway.app
- ✅ Бесплатный тариф $5/месяц
- ✅ Не засыпает
- ✅ Простая настройка
- ✅ Поддержка Docker

### 3. Netlify
- ✅ Бесплатный план
- ✅ Хорошая поддержка Next.js
- ⚠️ Может засыпать на free плане

### 4. Fly.io
- ✅ Бесплатный тариф
- ✅ Глобальная сеть
- ✅ Docker-first

## Рекомендации

**Для production:**
- **Vercel** - лучший выбор для Next.js (бесплатно, не засыпает, отличная производительность)
- **Railway** - если нужен Docker и больше контроля

**Для MVP:**
- **Render.com** - простая настройка, подходит для начала
- **Netlify** - альтернатива с хорошей поддержкой Next.js

## Проверка после деплоя

1. ✅ Откройте URL фронтенда
2. ✅ Проверьте что страница загружается
3. ✅ Попробуйте залогиниться
4. ✅ Проверьте что API запросы работают (откройте DevTools → Network)
5. ✅ Проверьте что нет ошибок в консоли браузера

## Обновление деплоя

Render автоматически обновляет деплой при push в основную ветку (обычно `main` или `master`).

Для ручного обновления:
- Зайдите в Dashboard → ваш сервис → "Manual Deploy"

